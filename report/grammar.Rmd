---
title: Grammar
author: Karl Meakin
geometry: margin=1cm
output:
  pdf_document:
    highlight: pygments
    latex_engine: xelatex
    pandoc_args: "--pdf-engine-opt=--shell-escape"
header-includes:
    - \usepackage{syntax}
---

\renewcommand{\lit}[1]{\texttt{#1}}
\newcommand{\opt}[1]{#1\textsuperscript{?}}
\newcommand{\manyZero}[1]{#1\textsuperscript{*}}
\newcommand{\manyOne}[1]{#1\textsuperscript{+}}

\newcommand{\manyZeroComma}[1]{#1\textsuperscript{,*}}
\newcommand{\manyOneComma}[1]{#1\textsuperscript{,+}}

\newcommand{\lcurly}{\lit{\{}}
\newcommand{\rcurly}{\lit{\}}}

# Comments
\begin{grammar}
<LineComment> ::= \lit{//} \manyZero{<any character>} <newline or end of file>

<BlockComment> ::= \lit{/*} \manyZero{<any character>} \manyZero{<BlockComment>} <any character> \lit{*/}
\end{grammar}

# Definitions
\begin{grammar}
<SourceFile> ::= <Definition>

<Definition> ::= <FnDefinition> | <StructDefinition> | <EnumDefinition> 

<FnDefinition> ::= \lit{fn} <ParamList> <ReturnType> <BlockExpr>

<StructDefinition> ::= \lit{struct} <Ident> \lcurly \manyZero{<Field>} \rcurly

<EnumDefinition> ::= \lit{enum} <Ident> \lcurly \manyZero{<EnumVariant>} \rcurly

<EnumVariant> ::= <Ident> \lcurly \manyZero{<Field>} \rcurly

<Field> ::= <Ident> \lit{:} <Type>
\end{grammar}

# Literals
\begin{grammar}
<Lit> ::= <BoolLit> | <IntLit> | <FloatLit> | <CharLit>

<BooLit> ::= \lit{true} | \lit{false} 

<IntLit> ::= <BinInt> | <DecInt> | <HexInt>

<BinInt> ::= \lit{0b} | \lit{0B}) <BinDigit> \manyZero{<BinDigit_>}

<BinDigit> ::= \lit{0} | \lit{1}

<BinDigit_> ::= <BinDigit> | \lit{_}

<DecInt> ::= <DecDigit> \manyZero{<DecDigit_>}

<DecDigit> ::= \lit{0} | \lit{1} | \lit{2} | \lit{3} | \lit{4} | \lit{5} | \lit{6} | \lit{7} | \lit{8} | \lit{9}

<DecDigit_> ::= <DecDigit> | \lit{_}

<HexInt> ::= (\lit{0x} | \lit{0X}) <HexDigit> \manyZero{<HexDigit_>}

<HexDigit_> ::= <HexDigit> | \lit{_}

<CharLit> ::= <SimpleChar> | <EscapedChar> | <UnicodeChar>

<SimpleChar> ::= \lit{'} <any character except single quote> \lit{'}

<EscapedChar> ::= \verb$'\n'$ | \verb$'\t'$ | \verb$'\\'$ | \verb$'\0'$ | \verb$'\''$ | \verb$'\"'$

<UnicodeChar> ::= \lit{'} (\verb$\u$ | \verb$\U$) <HexDigit> \manyZero{<HexDigit_>} \lit{'}
\end{grammar}

# Expressions
\begin{grammar}
<Expr> ::= <LitExpr> 
\alt <ParenExpr> 
\alt <VarExpr> 
\alt <UnopExpr> 
\alt <BinopExpr> 
\alt <CallExpr> 
\alt <LambdaExpr> 
\alt <IfExpr> 
\alt <LoopExpr> 
\alt <BreakExpr>
\alt <ContinueExpr>
\alt <ReturnExpr>
\alt <TupleExpr>
\alt <StructExpr>
\alt <EnumExpr>
\alt <FieldExpr>
\alt <MatchExpr>
\alt <BlockExpr> 

<LitExpr> ::= <Lit>

<ParenExpr> ::= \lit{(} <Expr> \lit{)}

<VarExpr> ::= <Ident>

<UnopExpr> ::= <Unop> <Expr>

<Unop> ::= \lit{+} | \lit{-}

<BinopExpr> ::= <Expr> <Binop> <Expr>

<Binop> ::= \lit{+} | \lit{-} | \lit{*} | \lit{/} | \lit{=} | \lit{==} | \lit{!=}  | \verb$<$ | \verb$>$ | \verb$<=$ | \verb$>=$ | \verb$||$ | \verb$&&$

<CallExpr> ::= <Expr> \lit{(} \manyZeroComma{<Expr>} \lit{)}

<LambdaExpr> ::= \lit{(} \manyZeroComma{<Pat>} \lit{)} \lit{=>} <Expr>

<IfExpr> ::= `if' <Expr> <BlockExpr> (`else' `if' <Expr> <BlockExpr>)\textsuperscript{*} (`else' <BlockExpr>)\textsuperscript{?}

<LoopExpr> ::= `loop' <Expr> <BlockExpr>

<BreakExpr> ::= `break' <Expr>\textsuperscript{?}

<ContinueExpr> ::= `continue'

<ReturnExpr> ::= `return' <Expr>\textsuperscript{?}

<TupleExpr> ::= `(' <Expr> `,' `)' | `(' <Expr>\textsuperscript{,*} `)'

<StructExpr> ::= <Ident> `{' (<Ident> `:' <Expr>)\textsuperscript{,*} `}'

<EnumExpr> ::= <Ident> `::' <Ident> `{' (<Ident> `:' <Expr>)\textsuperscript{,*} `}'

<FieldExpr> ::= <Expr> `.' (<Ident> | <IntLit>)

<MatchExpr> ::= `match' <Expr> `{' <MatchCase>\textsuperscript{,*} `}'

<MatchCase> ::= <Pat> `=>' <Expr>
\end{grammar}


# Types
\begin{grammar}
<Type> ::= <VarType> 
\alt <InferType>
\alt <TupleType>
\alt <FnType>

<VarType> ::= <Ident>

<InferType> ::= `_'

<TupleType> ::= `(' <Type> `,' `)'

<FnType> ::= `(' <Type>\textsuperscript{,*} `)' `->' <Type>
\end{grammar}


# Patterns
\begin{grammar}
<Pat> ::= <LitPat> 
\alt <VarPat>
\alt <IgnorePat>
\alt <TuplePat>
\alt <StructPat>
\alt <EnumPat>

<LitPat> ::= <Lit>

<VarPat> ::= <Ident>

<IgnorePat> ::= `_'

<TuplePat> ::= `(' <Pat> `,' `)' | `(' <Pat>\textsuperscript{,*} `)'

<StructPat> ::= <Ident> `{' <FieldPat>\textsuperscript{,*} `}'

<EnumExpr> ::= <Ident> `::' <Ident> `{' <FieldPat>\textsuperscript{,*} `}'
\end{grammar}


